{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/items.ts","webpack:///./src/recipes.ts","webpack:///./src/compute/computation-order.ts","webpack:///./src/compute/graph.ts","webpack:///./node_modules/immer/dist/immer.esm.js","webpack:///./src/compute/factory.ts","webpack:///./src/compute/simulated-annealing.ts","webpack:///./src/compute/ideal-machine-count.ts","webpack:///./src/main.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ItemType","other","volume","type","OTHER","MACHINE","ore","ORE","isOre","item","items","vertical_booster_l","adjuster_l","retro_rocket_brake_l","atmospheric_airbrake_l","basic_hydraulics","basic_mobile_panel_m","basic_standard_frame_m","basic_pipe","basic_screw","basic_burner","basic_ionic_chamber_m","basic_connector","basic_injector","basic_gaz_cylinder_m","al_fe_alloy","silumin","steel","polycarbonate_plastic","pure_aluminium","pure_silicon","pure_iron","pure_carbon","pure_oxygen","pure_hydrogen","bauxite","quarz","hematite","coal","smelter_m","refiner_m","metalwork_industry_m","assembly_line_m","assembly_line_l","chemical_industry_m","electronic_industry_m","batch","quantity","recipes","product","byproducts","ingredients","producedWith","processingTime","findRecipe","recipe","find","process","Error","ItemNode","dependencies","Set","dependents","node","this","add","dependent","delete","dependency","determineComputationOrder","finalProducts","nodes","Map","todo","has","set","dependsOn","forEach","ingredient","buildDependencyGraph","order","startNodes","Array","from","map","size","push","destroy","ContainerNode","producers","consumers","producer","getOutput","reduce","totalIngress","ingress","getIntakeFrom","totalEgress","egress","MachineNode","utilization","inputs","output","undefined","container","getIntake","FactoryGraph","filter","is","machines","some","containers","getEgress","getIngress","arguments","length","e","join","Q","getPrototypeOf","isArray","L","constructor","v","keys","Z","u","a","f","X","q","slice","nn","writable","configurable","y","clear","h","freeze","isFrozen","b","tn","_","U","j","g","O","S","w","P","M","x","H","A","I","k","R","D","concat","N","z","getOwnPropertyDescriptor","E","T","F","C","rn","en","Proxy","revocable","revoke","proxy","J","K","JSON","stringify","setPrototypeOf","__proto__","values","V","next","done","entries","G","W","B","Reflect","for","iterator","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","getOwnPropertyDescriptors","deleteProperty","apply","un","useProxies","setUseProxies","autoFreeze","setAutoFreeze","produce","produceWithPatches","Promise","then","createDraft","finishDraft","applyPatches","path","op","$","an","addInputContainers","graph","consumer","getConsumers","takeFrom","addProducers","result","initialState","mutateState","computeEnergy","tempMax","tempMin","coolTemp","currentTemp","currentState","currentEnergy","bestState","bestEnergy","temp","nextState","nextEnergy","Math","exp","random","simulateAnnealing","getContainers","oldStates","containerExistsAlready","futureConsumers","newStates","makeInitialStates","states","state","chooseRandom","containerState","removeRandomConsumer","machineThroughput","outgoingLinkCount","netIngress","neededMachines","ceil","max","incomingLinkCount","addToRandomContainer","mutateLinks","energy","utilisation","machine","outputInto","arr","floor","ItemsFlow","itemsStream","super","itemOrStream","throughput","every","covers","remainder","subtract","computeDependentThroughputs","throughputs","dependentItemsGetter","dependentThroughputs","dependentItem","dependentThroughput","computeAdditionalThroughputs","minimumEgress","additionalThroughputs","remainingIngress","assign","window","buildFactory","products","machineCount","initGraph","computationOrder","console","log","computeIdealMachineCount","computeThroughputs","byproductEgress","updatedByproductsEgress"],"mappings":"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","file":"main.6b321ede24671e656def.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/du-factory-generator/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export type Liter = number\nexport type Minutes = number\nexport type Quantity = number\n\nexport type Item = Machine | Container | Ore | Other\n\nexport enum ItemType {\n    MACHINE = \"machine\",\n    CONTAINER = \"container\",\n    ORE = \"ore\",\n    OTHER = \"product\",\n}\n\nexport interface Container extends CommonProperties {\n    readonly type: ItemType.CONTAINER\n}\n\nexport interface Machine extends CommonProperties {\n    readonly type: ItemType.MACHINE\n}\n\nexport interface Other extends CommonProperties {\n    readonly type: ItemType.OTHER\n}\n\nexport interface Ore extends CommonProperties {\n    readonly type: ItemType.ORE\n}\n\nexport interface CommonProperties {\n    readonly name: string\n    readonly volume: Liter\n}\n\nexport function other(name: string, volume: Liter): Other {\n    return {\n        type: ItemType.OTHER,\n        name,\n        volume,\n    }\n}\n\nexport function machine(name: string, volume: Liter): Machine {\n    return {\n        type: ItemType.MACHINE,\n        name,\n        volume,\n    }\n}\n\nexport function isMachine(item: Item): item is Machine {\n    return item.type === ItemType.ORE\n}\n\nexport function container(name: string, volume: Liter): Container {\n    return {\n        type: ItemType.CONTAINER,\n        name,\n        volume,\n    }\n}\n\nexport function isContainer(item: Item): item is Container {\n    return item.type === ItemType.CONTAINER\n}\n\nexport function ore(name: string): Ore {\n    return {\n        type: ItemType.ORE,\n        name,\n        volume: 1,\n    }\n}\n\nexport function isOre(item: Item): item is Ore {\n    return item.type === ItemType.ORE\n}\n\nexport const items = {\n    vertical_booster_l: other(\"Vertical booster L\", 562.4),\n    adjuster_l: other(\"Adjuster L\", 619.2),\n    retro_rocket_brake_l: other(\"Retro-rocket brake L\", 562.4),\n    atmospheric_airbrake_l: other(\"Atmospheric airbrake L\", 619.2),\n\n    basic_hydraulics: other(\"Basic hydraulics\", 10),\n    basic_mobile_panel_m: other(\"Basic mobile panel M\", 259.2),\n\n    basic_standard_frame_m: other(\"Basic standard frame M\", 74),\n    basic_pipe: other(\"Basic pipe\", 1),\n    basic_screw: other(\"Basic screw\", 1),\n    basic_burner: other(\"Basic burner\", 10),\n    basic_ionic_chamber_m: other(\"Basic ionic chamber M\", 202.4),\n    basic_connector: other(\"Basic connector\", 0.8),\n    basic_injector: other(\"Basic injector\", 10),\n    basic_gaz_cylinder_m: other(\"Basic gaz cylinder M\", 259.2),\n\n    al_fe_alloy: other(\"Al-Fe alloy\", 1),\n    silumin: other(\"Silumin\", 1),\n    steel: other(\"Steel\", 1),\n\n    polycarbonate_plastic: other(\"Polycarbonate plastic\", 1),\n\n    pure_aluminium: other(\"Pure aluminium\", 1),\n    pure_silicon: other(\"Pure silicon\", 1),\n    pure_iron: other(\"Pure iron\", 1),\n    pure_carbon: other(\"Pure carbon\", 1),\n\n    pure_oxygen: ore(\"Pure oxygen\"), // TODO\n    pure_hydrogen: ore(\"Pure hydrogen\"), // TODO\n\n    bauxite: ore(\"Bauxite\"),\n    quarz: ore(\"Quarz\"),\n    hematite: ore(\"Hematite\"),\n    coal: ore(\"Coal\"),\n\n    smelter_m: machine(\"Smelter M\", 499.2),\n    refiner_m: machine(\"Refiner M\", 479.2),\n    metalwork_industry_m: machine(\"Metalwork industry M\", 599.2),\n    assembly_line_m: machine(\"Assembly line M\", 599.2),\n    assembly_line_l: machine(\"Assembly line L\", 3255.4),\n    chemical_industry_m: machine(\"Chemical industry M\", 479.2),\n    electronic_industry_m: machine(\"Electronical industry M\", 459.2),\n    \"3d_prnter_m\": machine(\"3D printer M\", 609.2),\n}\n","import { Item, items, Machine, Minutes, Ore, Quantity } from \"./items\"\n\nexport interface Batch {\n    readonly item: Item\n    readonly quantity: Quantity\n}\n\nexport interface Recipe {\n    readonly product: Batch\n    readonly byproducts: Batch[]\n    readonly ingredients: Batch[]\n    readonly producedWith: Machine\n    readonly processingTime: Minutes\n}\n\nexport function batch(item: Item, quantity: Quantity): Batch {\n    return {\n        item,\n        quantity,\n    }\n}\n\nexport const recipes: Recipe[] = [\n    {\n        product: batch(items.adjuster_l, 1),\n        byproducts: [],\n        ingredients: [\n            batch(items.basic_pipe, 36),\n            batch(items.basic_injector, 25),\n            batch(items.basic_gaz_cylinder_m, 1),\n            batch(items.basic_standard_frame_m, 1),\n        ],\n        producedWith: items.assembly_line_m,\n        processingTime: 32,\n    },\n    {\n        product: batch(items.vertical_booster_l, 1),\n        byproducts: [],\n        ingredients: [\n            batch(items.basic_pipe, 36),\n            batch(items.basic_injector, 25),\n            batch(items.basic_ionic_chamber_m, 1),\n            batch(items.basic_standard_frame_m, 1),\n        ],\n        producedWith: items.assembly_line_m,\n        processingTime: 32,\n    },\n    {\n        product: batch(items.basic_injector, 3),\n        byproducts: [],\n        ingredients: [batch(items.polycarbonate_plastic, 18), batch(items.basic_screw, 12)],\n        producedWith: items[\"3d_prnter_m\"],\n        processingTime: 3,\n    },\n    {\n        product: batch(items.polycarbonate_plastic, 75),\n        byproducts: [],\n        ingredients: [batch(items.pure_carbon, 100), batch(items.pure_hydrogen, 50)],\n        producedWith: items.chemical_industry_m,\n        processingTime: 3,\n    },\n    {\n        product: batch(items.atmospheric_airbrake_l, 1),\n        byproducts: [],\n        ingredients: [\n            batch(items.basic_pipe, 36),\n            batch(items.basic_hydraulics, 25),\n            batch(items.basic_mobile_panel_m, 1),\n            batch(items.basic_standard_frame_m, 1),\n        ],\n        producedWith: items.assembly_line_m,\n        processingTime: 32,\n    },\n    {\n        product: batch(items.basic_pipe, 10),\n        byproducts: [],\n        ingredients: [batch(items.silumin, 10)],\n        producedWith: items.metalwork_industry_m,\n        processingTime: 2,\n    },\n    {\n        product: batch(items.basic_hydraulics, 3),\n        byproducts: [],\n        ingredients: [batch(items.basic_pipe, 12), batch(items.steel, 18)],\n        producedWith: items.metalwork_industry_m,\n        processingTime: 3,\n    },\n    {\n        product: batch(items.basic_mobile_panel_m, 1),\n        byproducts: [],\n        ingredients: [batch(items.silumin, 49), batch(items.basic_screw, 25)],\n        producedWith: items.metalwork_industry_m,\n        processingTime: 9,\n    },\n    {\n        product: batch(items.basic_screw, 10),\n        byproducts: [],\n        ingredients: [batch(items.steel, 10)],\n        producedWith: items.metalwork_industry_m,\n        processingTime: 2,\n    },\n    {\n        product: batch(items.basic_standard_frame_m, 1),\n        byproducts: [],\n        ingredients: [batch(items.silumin, 74)],\n        producedWith: items.metalwork_industry_m,\n        processingTime: 6,\n    },\n    {\n        product: batch(items.steel, 75),\n        byproducts: [],\n        ingredients: [batch(items.pure_iron, 100), batch(items.pure_carbon, 50)],\n        producedWith: items.smelter_m,\n        processingTime: 3,\n    },\n    {\n        product: batch(items.silumin, 75),\n        byproducts: [],\n        ingredients: [batch(items.pure_aluminium, 100), batch(items.pure_silicon, 50)],\n        producedWith: items.smelter_m,\n        processingTime: 3,\n    },\n    {\n        product: batch(items.pure_silicon, 360),\n        byproducts: [batch(items.pure_oxygen, 120)],\n        ingredients: [batch(items.quarz, 520)],\n        producedWith: items.refiner_m,\n        processingTime: 3,\n    },\n    {\n        product: batch(items.pure_carbon, 360),\n        byproducts: [batch(items.pure_oxygen, 60), batch(items.pure_hydrogen, 60)],\n        ingredients: [batch(items.coal, 520)],\n        producedWith: items.refiner_m,\n        processingTime: 3,\n    },\n    {\n        product: batch(items.pure_aluminium, 360),\n        byproducts: [batch(items.pure_hydrogen, 120)],\n        ingredients: [batch(items.bauxite, 520)],\n        producedWith: items.refiner_m,\n        processingTime: 3,\n    },\n    {\n        product: batch(items.pure_iron, 360),\n        byproducts: [batch(items.pure_oxygen, 120)],\n        ingredients: [batch(items.hematite, 520)],\n        producedWith: items.refiner_m,\n        processingTime: 3,\n    },\n    {\n        product: batch(items.al_fe_alloy, 75),\n        byproducts: [],\n        ingredients: [batch(items.pure_aluminium, 100), batch(items.pure_carbon, 50)],\n        producedWith: items.smelter_m,\n        processingTime: 3,\n    },\n    {\n        product: batch(items.basic_connector, 10),\n        byproducts: [],\n        ingredients: [batch(items.al_fe_alloy, 10)],\n        producedWith: items.electronic_industry_m,\n        processingTime: 2,\n    },\n    {\n        product: batch(items.basic_ionic_chamber_m, 1),\n        byproducts: [],\n        ingredients: [batch(items.steel, 49), batch(items.basic_connector, 25)],\n        producedWith: items.metalwork_industry_m,\n        processingTime: 9,\n    },\n    {\n        product: batch(items.basic_burner, 3),\n        byproducts: [],\n        ingredients: [batch(items.silumin, 18), batch(items.basic_screw, 12)],\n        producedWith: items.metalwork_industry_m,\n        processingTime: 3,\n    },\n    {\n        product: batch(items.retro_rocket_brake_l, 1),\n        byproducts: [],\n        ingredients: [\n            batch(items.basic_screw, 36),\n            batch(items.basic_burner, 25),\n            batch(items.basic_ionic_chamber_m, 1),\n            batch(items.basic_standard_frame_m, 1),\n        ],\n        producedWith: items.assembly_line_m,\n        processingTime: 32,\n    },\n    {\n        product: batch(items.basic_gaz_cylinder_m, 1),\n        byproducts: [],\n        ingredients: [batch(items.silumin, 49), batch(items.basic_screw, 25)],\n        producedWith: items.metalwork_industry_m,\n        processingTime: 9,\n    },\n]\n\nexport function findRecipe(item: Exclude<Item, Ore>): Recipe {\n    const recipe = recipes.find((process) => process.product.item === item)\n    if (recipe) {\n        return recipe\n    } else {\n        throw new Error(`No recipe found for product \"${item.name}\".`)\n    }\n}\n","import { isOre, Item } from \"../items\"\nimport { findRecipe } from \"../recipes\"\n\nclass ItemNode {\n    readonly dependencies = new Set<ItemNode>()\n    readonly dependents = new Set<ItemNode>()\n\n    constructor(readonly item: Item) {}\n\n    dependsOn(node: ItemNode) {\n        this.dependencies.add(node)\n        node.dependents.add(this)\n    }\n\n    destroy() {\n        for (const dependent of this.dependents) {\n            dependent.dependencies.delete(this)\n        }\n        for (const dependency of this.dependencies) {\n            dependency.dependents.delete(this)\n        }\n    }\n}\n\nfunction buildDependencyGraph(finalProducts: Set<Item>): Map<Item, ItemNode> {\n    const nodes = new Map<Item, ItemNode>()\n\n    const todo = new Set(finalProducts)\n\n    for (const item of todo) {\n        if (isOre(item)) {\n            continue\n        }\n\n        if (!nodes.has(item)) {\n            nodes.set(item, new ItemNode(item))\n        }\n        const node = nodes.get(item)!\n\n        const process = findRecipe(item)\n\n        for (const dependent of [...process.ingredients, ...process.byproducts]) {\n            if (!nodes.has(dependent.item)) {\n                nodes.set(dependent.item, new ItemNode(dependent.item))\n            }\n            const dependentNode = nodes.get(dependent.item)!\n\n            dependentNode.dependsOn(node)\n        }\n\n        process.ingredients.forEach((ingredient) => todo.add(ingredient.item))\n    }\n\n    return nodes\n}\n\nexport function determineComputationOrder(finalProducts: Set<Item>): Item[] {\n    const nodes = buildDependencyGraph(finalProducts)\n\n    const order: Item[] = []\n\n    const startNodes = Array.from(finalProducts).map((item) => nodes.get(item)!)\n    const todo = new Set(startNodes)\n\n    for (const node of todo) {\n        todo.delete(node)\n\n        for (const dependency of node.dependencies) {\n            todo.add(dependency)\n        }\n\n        if (node.dependencies.size === 0) {\n            order.push(node.item)\n\n            for (const dependent of node.dependents) {\n                todo.add(dependent)\n            }\n\n            node.destroy()\n        }\n    }\n\n    return order\n}\n","import { Item } from \"../items\"\nimport { Recipe } from \"../recipes\"\n\n/** unit: item / minute */\nexport type ItemRate = number\n\nexport class ContainerNode {\n    readonly producers = new Set<MachineNode>()\n    readonly consumers = new Set<MachineNode>()\n\n    get incomingLinkCount(): number {\n        return this.producers.size\n    }\n\n    get outgoingLinkCount(): number {\n        return this.consumers.size\n    }\n\n    static is(node: FactoryNode): node is ContainerNode {\n        return node instanceof ContainerNode\n    }\n\n    getIngress(item: Item): ItemRate {\n        return Array.from(this.producers)\n            .map((producer) => producer.getOutput(item))\n            .reduce((totalIngress, ingress) => totalIngress + ingress, 0)\n    }\n\n    getEgress(item: Item): ItemRate {\n        return Array.from(this.consumers)\n            .map((producer) => producer.getIntakeFrom(this, item))\n            .reduce((totalEgress, egress) => totalEgress + egress, 0)\n    }\n}\n\nexport class MachineNode {\n    readonly inputs = new Map<Item, ContainerNode>()\n    output: ContainerNode | undefined = undefined\n\n    constructor(readonly recipe: Recipe, readonly utilization: number) {}\n\n    static is(node: FactoryNode): node is MachineNode {\n        return node instanceof MachineNode\n    }\n\n    takeFrom(container: ContainerNode, item: Item) {\n        this.inputs.set(item, container)\n        container.consumers.add(this)\n    }\n\n    outputInto(container: ContainerNode) {\n        if (this.output) {\n            this.output.producers.delete(this)\n        }\n\n        this.output = container\n        container.producers.add(this)\n    }\n\n    getIntake(item: Item): ItemRate {\n        let quantity = 0\n        for (const ingredient of this.recipe.ingredients) {\n            if (ingredient.item === item) {\n                quantity += ingredient.quantity\n            }\n        }\n        return (this.utilization * quantity) / this.recipe.processingTime\n    }\n\n    getIntakeFrom(container: ContainerNode, item: Item): ItemRate {\n        if (this.inputs.get(item) !== container) {\n            return 0\n        }\n        return this.getIntake(item)\n    }\n\n    getOutput(item: Item): ItemRate {\n        let quantity = 0\n        for (const product of [...this.recipe.byproducts, this.recipe.product]) {\n            if (product.item === item) {\n                quantity += product.quantity\n            }\n        }\n        return (this.utilization * quantity) / this.recipe.processingTime\n    }\n}\n\nexport type FactoryNode = ContainerNode | MachineNode\n\nexport class FactoryGraph extends Set<FactoryNode> {\n    get machines(): Set<MachineNode> {\n        return new Set(Array.from(this).filter(MachineNode.is))\n    }\n\n    get containers(): Set<ContainerNode> {\n        return new Set(Array.from(this).filter(ContainerNode.is))\n    }\n\n    getConsumers(item: Item): Set<MachineNode> {\n        return new Set(\n            Array.from(this.machines).filter((node) =>\n                node.recipe.ingredients.some((ingredient) => ingredient.item === item),\n            ),\n        )\n    }\n\n    getContainers(item: Item): Set<ContainerNode> {\n        return new Set(\n            Array.from(this.containers).filter(\n                (node) => node.getEgress(item) > 0 || node.getIngress(item) > 0,\n            ),\n        )\n    }\n}\n","function n(n){for(var t=arguments.length,r=Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];if(\"production\"!==process.env.NODE_ENV){var i=Y[n],o=i?\"function\"==typeof i?i.apply(null,r):i:\"unknown error nr: \"+n;throw Error(\"[Immer] \"+o)}throw Error(\"[Immer] minified error nr: \"+n+(r.length?\" \"+r.join(\",\"):\"\")+\". Find the full error at: https://bit.ly/3cXEKWf\")}function t(n){return!!n&&!!n[Q]}function r(n){return!!n&&(function(n){if(!n||\"object\"!=typeof n)return!1;var t=Object.getPrototypeOf(n);return!t||t===Object.prototype}(n)||Array.isArray(n)||!!n[L]||!!n.constructor[L]||s(n)||v(n))}function e(r){return t(r)||n(23,r),r[Q].t}function i(n,t,r){void 0===r&&(r=!1),0===o(n)?(r?Object.keys:Z)(n).forEach((function(e){r&&\"symbol\"==typeof e||t(e,n[e],n)})):n.forEach((function(r,e){return t(e,r,n)}))}function o(n){var t=n[Q];return t?t.i>3?t.i-4:t.i:Array.isArray(n)?1:s(n)?2:v(n)?3:0}function u(n,t){return 2===o(n)?n.has(t):Object.prototype.hasOwnProperty.call(n,t)}function a(n,t){return 2===o(n)?n.get(t):n[t]}function f(n,t,r){var e=o(n);2===e?n.set(t,r):3===e?(n.delete(t),n.add(r)):n[t]=r}function c(n,t){return n===t?0!==n||1/n==1/t:n!=n&&t!=t}function s(n){return X&&n instanceof Map}function v(n){return q&&n instanceof Set}function p(n){return n.o||n.t}function l(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var t=nn(n);delete t[Q];for(var r=Z(t),e=0;e<r.length;e++){var i=r[e],o=t[i];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),t)}function d(n,e){y(n)||t(n)||!r(n)||(o(n)>1&&(n.set=n.add=n.clear=n.delete=h),Object.freeze(n),e&&i(n,(function(n,t){return d(t,!0)}),!0))}function h(){n(2)}function y(n){return null==n||\"object\"!=typeof n||Object.isFrozen(n)}function b(t){var r=tn[t];return r||n(\"production\"!==process.env.NODE_ENV?18:19,t),r}function m(n,t){tn[n]=t}function _(){return\"production\"===process.env.NODE_ENV||U||n(0),U}function j(n,t){t&&(b(\"Patches\"),n.u=[],n.s=[],n.v=t)}function g(n){O(n),n.p.forEach(S),n.p=null}function O(n){n===U&&(U=n.l)}function w(n){return U={p:[],l:U,h:n,m:!0,_:0}}function S(n){var t=n[Q];0===t.i||1===t.i?t.j():t.g=!0}function P(t,e){e._=e.p.length;var i=e.p[0],o=void 0!==t&&t!==i;return e.h.O||b(\"ES5\").S(e,t,o),o?(i[Q].P&&(g(e),n(4)),r(t)&&(t=M(e,t),e.l||x(e,t)),e.u&&b(\"Patches\").M(i[Q],t,e.u,e.s)):t=M(e,i,[]),g(e),e.u&&e.v(e.u,e.s),t!==H?t:void 0}function M(n,t,r){if(y(t))return t;var e=t[Q];if(!e)return i(t,(function(i,o){return A(n,e,t,i,o,r)}),!0),t;if(e.A!==n)return t;if(!e.P)return x(n,e.t,!0),e.t;if(!e.I){e.I=!0,e.A._--;var o=4===e.i||5===e.i?e.o=l(e.k):e.o;i(3===e.i?new Set(o):o,(function(t,i){return A(n,e,o,t,i,r)})),x(n,o,!1),r&&n.u&&b(\"Patches\").R(e,r,n.u,n.s)}return e.o}function A(e,i,o,a,c,s){if(\"production\"!==process.env.NODE_ENV&&c===o&&n(5),t(c)){var v=M(e,c,s&&i&&3!==i.i&&!u(i.D,a)?s.concat(a):void 0);if(f(o,a,v),!t(v))return;e.m=!1}if(r(c)&&!y(c)){if(!e.h.N&&e._<1)return;M(e,c),i&&i.A.l||x(e,c)}}function x(n,t,r){void 0===r&&(r=!1),n.h.N&&n.m&&d(t,r)}function z(n,t){var r=n[Q];return(r?p(r):n)[t]}function I(n,t){if(t in n)for(var r=Object.getPrototypeOf(n);r;){var e=Object.getOwnPropertyDescriptor(r,t);if(e)return e;r=Object.getPrototypeOf(r)}}function E(n){n.P||(n.P=!0,n.l&&E(n.l))}function k(n){n.o||(n.o=l(n.t))}function R(n,t,r){var e=s(t)?b(\"MapSet\").T(t,r):v(t)?b(\"MapSet\").F(t,r):n.O?function(n,t){var r=Array.isArray(n),e={i:r?1:0,A:t?t.A:_(),P:!1,I:!1,D:{},l:t,t:n,k:null,o:null,j:null,C:!1},i=e,o=rn;r&&(i=[e],o=en);var u=Proxy.revocable(i,o),a=u.revoke,f=u.proxy;return e.k=f,e.j=a,f}(t,r):b(\"ES5\").J(t,r);return(r?r.A:_()).p.push(e),e}function D(e){return t(e)||n(22,e),function n(t){if(!r(t))return t;var e,u=t[Q],c=o(t);if(u){if(!u.P&&(u.i<4||!b(\"ES5\").K(u)))return u.t;u.I=!0,e=N(t,c),u.I=!1}else e=N(t,c);return i(e,(function(t,r){u&&a(u.t,t)===r||f(e,t,n(r))})),3===c?new Set(e):e}(e)}function N(n,t){switch(t){case 2:return new Map(n);case 3:return Array.from(n)}return l(n)}function T(){function r(n,t){var r=s[n];return r?r.enumerable=t:s[n]=r={configurable:!0,enumerable:t,get:function(){var t=this[Q];return\"production\"!==process.env.NODE_ENV&&f(t),rn.get(t,n)},set:function(t){var r=this[Q];\"production\"!==process.env.NODE_ENV&&f(r),rn.set(r,n,t)}},r}function e(n){for(var t=n.length-1;t>=0;t--){var r=n[t][Q];if(!r.P)switch(r.i){case 5:a(r)&&E(r);break;case 4:o(r)&&E(r)}}}function o(n){for(var t=n.t,r=n.k,e=Z(r),i=e.length-1;i>=0;i--){var o=e[i];if(o!==Q){var a=t[o];if(void 0===a&&!u(t,o))return!0;var f=r[o],s=f&&f[Q];if(s?s.t!==a:!c(f,a))return!0}}var v=!!t[Q];return e.length!==Z(t).length+(v?0:1)}function a(n){var t=n.k;if(t.length!==n.t.length)return!0;var r=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!r||r.get)}function f(t){t.g&&n(3,JSON.stringify(p(t)))}var s={};m(\"ES5\",{J:function(n,t){var e=Array.isArray(n),i=function(n,t){if(n){for(var e=Array(t.length),i=0;i<t.length;i++)Object.defineProperty(e,\"\"+i,r(i,!0));return e}var o=nn(t);delete o[Q];for(var u=Z(o),a=0;a<u.length;a++){var f=u[a];o[f]=r(f,n||!!o[f].enumerable)}return Object.create(Object.getPrototypeOf(t),o)}(e,n),o={i:e?5:4,A:t?t.A:_(),P:!1,I:!1,D:{},l:t,t:n,k:i,o:null,g:!1,C:!1};return Object.defineProperty(i,Q,{value:o,writable:!0}),i},S:function(n,r,o){o?t(r)&&r[Q].A===n&&e(n.p):(n.u&&function n(t){if(t&&\"object\"==typeof t){var r=t[Q];if(r){var e=r.t,o=r.k,f=r.D,c=r.i;if(4===c)i(o,(function(t){t!==Q&&(void 0!==e[t]||u(e,t)?f[t]||n(o[t]):(f[t]=!0,E(r)))})),i(e,(function(n){void 0!==o[n]||u(o,n)||(f[n]=!1,E(r))}));else if(5===c){if(a(r)&&(E(r),f.length=!0),o.length<e.length)for(var s=o.length;s<e.length;s++)f[s]=!1;else for(var v=e.length;v<o.length;v++)f[v]=!0;for(var p=Math.min(o.length,e.length),l=0;l<p;l++)void 0===f[l]&&n(o[l])}}}}(n.p[0]),e(n.p))},K:function(n){return 4===n.i?o(n):a(n)}})}function F(){function r(n){if(!n||\"object\"!=typeof n)return n;if(Array.isArray(n))return n.map(r);if(s(n))return new Map(Array.from(n.entries()).map((function(n){return[n[0],r(n[1])]})));if(v(n))return new Set(Array.from(n).map(r));var t=Object.create(Object.getPrototypeOf(n));for(var e in n)t[e]=r(n[e]);return t}function e(n){return t(n)?r(n):n}var f=\"add\";m(\"Patches\",{$:function(t,e){return e.forEach((function(e){for(var i=e.path,u=e.op,c=t,s=0;s<i.length-1;s++)\"object\"!=typeof(c=a(c,i[s]))&&n(15,i.join(\"/\"));var v=o(c),p=r(e.value),l=i[i.length-1];switch(u){case\"replace\":switch(v){case 2:return c.set(l,p);case 3:n(16);default:return c[l]=p}case f:switch(v){case 1:return c.splice(l,0,p);case 2:return c.set(l,p);case 3:return c.add(p);default:return c[l]=p}case\"remove\":switch(v){case 1:return c.splice(l,1);case 2:return c.delete(l);case 3:return c.delete(e.value);default:return delete c[l]}default:n(17,u)}})),t},R:function(n,t,r,o){switch(n.i){case 0:case 4:case 2:return function(n,t,r,o){var c=n.t,s=n.o;i(n.D,(function(n,i){var v=a(c,n),p=a(s,n),l=i?u(c,n)?\"replace\":f:\"remove\";if(v!==p||\"replace\"!==l){var d=t.concat(n);r.push(\"remove\"===l?{op:l,path:d}:{op:l,path:d,value:p}),o.push(l===f?{op:\"remove\",path:d}:\"remove\"===l?{op:f,path:d,value:e(v)}:{op:\"replace\",path:d,value:e(v)})}}))}(n,t,r,o);case 5:case 1:return function(n,t,r,i){var o=n.t,u=n.D,a=n.o;if(a.length<o.length){var c=[a,o];o=c[0],a=c[1];var s=[i,r];r=s[0],i=s[1]}for(var v=0;v<o.length;v++)if(u[v]&&a[v]!==o[v]){var p=t.concat([v]);r.push({op:\"replace\",path:p,value:e(a[v])}),i.push({op:\"replace\",path:p,value:e(o[v])})}for(var l=o.length;l<a.length;l++){var d=t.concat([l]);r.push({op:f,path:d,value:e(a[l])})}o.length<a.length&&i.push({op:\"replace\",path:t.concat([\"length\"]),value:o.length})}(n,t,r,o);case 3:return function(n,t,r,e){var i=n.t,o=n.o,u=0;i.forEach((function(n){if(!o.has(n)){var i=t.concat([u]);r.push({op:\"remove\",path:i,value:n}),e.unshift({op:f,path:i,value:n})}u++})),u=0,o.forEach((function(n){if(!i.has(n)){var o=t.concat([u]);r.push({op:f,path:o,value:n}),e.unshift({op:\"remove\",path:o,value:n})}u++}))}(n,t,r,o)}},M:function(n,t,r,e){r.push({op:\"replace\",path:[],value:t}),e.push({op:\"replace\",path:[],value:n.t})}})}function C(){function t(n,t){function r(){this.constructor=n}a(n,t),n.prototype=(r.prototype=t.prototype,new r)}function e(n){n.o||(n.D=new Map,n.o=new Map(n.t))}function o(n){n.o||(n.o=new Set,n.t.forEach((function(t){if(r(t)){var e=R(n.A.h,t,n);n.p.set(t,e),n.o.add(e)}else n.o.add(t)})))}function u(t){t.g&&n(3,JSON.stringify(p(t)))}var a=function(n,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])})(n,t)},f=function(){function n(n,t){return this[Q]={i:2,l:t,A:t?t.A:_(),P:!1,I:!1,o:void 0,D:void 0,t:n,k:this,C:!1,g:!1},this}t(n,Map);var o=n.prototype;return Object.defineProperty(o,\"size\",{get:function(){return p(this[Q]).size}}),o.has=function(n){return p(this[Q]).has(n)},o.set=function(n,t){var r=this[Q];return u(r),p(r).has(n)&&p(r).get(n)===t||(e(r),E(r),r.D.set(n,!0),r.o.set(n,t),r.D.set(n,!0)),this},o.delete=function(n){if(!this.has(n))return!1;var t=this[Q];return u(t),e(t),E(t),t.D.set(n,!1),t.o.delete(n),!0},o.clear=function(){var n=this[Q];return u(n),e(n),E(n),n.D=new Map,i(n.t,(function(t){n.D.set(t,!1)})),n.o.clear()},o.forEach=function(n,t){var r=this;p(this[Q]).forEach((function(e,i){n.call(t,r.get(i),i,r)}))},o.get=function(n){var t=this[Q];u(t);var i=p(t).get(n);if(t.I||!r(i))return i;if(i!==t.t.get(n))return i;var o=R(t.A.h,i,t);return e(t),t.o.set(n,o),o},o.keys=function(){return p(this[Q]).keys()},o.values=function(){var n,t=this,r=this.keys();return(n={})[V]=function(){return t.values()},n.next=function(){var n=r.next();return n.done?n:{done:!1,value:t.get(n.value)}},n},o.entries=function(){var n,t=this,r=this.keys();return(n={})[V]=function(){return t.entries()},n.next=function(){var n=r.next();if(n.done)return n;var e=t.get(n.value);return{done:!1,value:[n.value,e]}},n},o[V]=function(){return this.entries()},n}(),c=function(){function n(n,t){return this[Q]={i:3,l:t,A:t?t.A:_(),P:!1,I:!1,o:void 0,t:n,k:this,p:new Map,g:!1,C:!1},this}t(n,Set);var r=n.prototype;return Object.defineProperty(r,\"size\",{get:function(){return p(this[Q]).size}}),r.has=function(n){var t=this[Q];return u(t),t.o?!!t.o.has(n)||!(!t.p.has(n)||!t.o.has(t.p.get(n))):t.t.has(n)},r.add=function(n){var t=this[Q];return u(t),this.has(n)||(o(t),E(t),t.o.add(n)),this},r.delete=function(n){if(!this.has(n))return!1;var t=this[Q];return u(t),o(t),E(t),t.o.delete(n)||!!t.p.has(n)&&t.o.delete(t.p.get(n))},r.clear=function(){var n=this[Q];return u(n),o(n),E(n),n.o.clear()},r.values=function(){var n=this[Q];return u(n),o(n),n.o.values()},r.entries=function(){var n=this[Q];return u(n),o(n),n.o.entries()},r.keys=function(){return this.values()},r[V]=function(){return this.values()},r.forEach=function(n,t){for(var r=this.values(),e=r.next();!e.done;)n.call(t,e.value,e.value,this),e=r.next()},n}();m(\"MapSet\",{T:function(n,t){return new f(n,t)},F:function(n,t){return new c(n,t)}})}function J(){T(),C(),F()}function K(n){return n}function $(n){return n}var G,U,W=\"undefined\"!=typeof Symbol&&\"symbol\"==typeof Symbol(\"x\"),X=\"undefined\"!=typeof Map,q=\"undefined\"!=typeof Set,B=\"undefined\"!=typeof Proxy&&void 0!==Proxy.revocable&&\"undefined\"!=typeof Reflect,H=W?Symbol.for(\"immer-nothing\"):((G={})[\"immer-nothing\"]=!0,G),L=W?Symbol.for(\"immer-draftable\"):\"__$immer_draftable\",Q=W?Symbol.for(\"immer-state\"):\"__$immer_state\",V=\"undefined\"!=typeof Symbol&&Symbol.iterator||\"@@iterator\",Y={0:\"Illegal state\",1:\"Immer drafts cannot have computed properties\",2:\"This object has been frozen and should not be mutated\",3:function(n){return\"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? \"+n},4:\"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.\",5:\"Immer forbids circular references\",6:\"The first or second argument to `produce` must be a function\",7:\"The third argument to `produce` must be a function or undefined\",8:\"First argument to `createDraft` must be a plain object, an array, or an immerable object\",9:\"First argument to `finishDraft` must be a draft returned by `createDraft`\",10:\"The given draft is already finalized\",11:\"Object.defineProperty() cannot be used on an Immer draft\",12:\"Object.setPrototypeOf() cannot be used on an Immer draft\",13:\"Immer only supports deleting array indices\",14:\"Immer only supports setting array indices and the 'length' property\",15:function(n){return\"Cannot apply patch, path doesn't resolve: \"+n},16:'Sets cannot have \"replace\" patches.',17:function(n){return\"Unsupported patch operation: \"+n},18:function(n){return\"The plugin for '\"+n+\"' has not been loaded into Immer. To enable the plugin, import and call `enable\"+n+\"()` when initializing your application.\"},19:\"plugin not loaded\",20:\"Cannot use proxies if Proxy, Proxy.revocable or Reflect are not available\",21:function(n){return\"produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '\"+n+\"'\"},22:function(n){return\"'current' expects a draft, got: \"+n},23:function(n){return\"'original' expects a draft, got: \"+n}},Z=\"undefined\"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,nn=Object.getOwnPropertyDescriptors||function(n){var t={};return Z(n).forEach((function(r){t[r]=Object.getOwnPropertyDescriptor(n,r)})),t},tn={},rn={get:function(n,t){if(t===Q)return n;var e=p(n);if(!u(e,t))return function(n,t,r){var e,i=I(t,r);return i?\"value\"in i?i.value:null===(e=i.get)||void 0===e?void 0:e.call(n.k):void 0}(n,e,t);var i=e[t];return n.I||!r(i)?i:i===z(n.t,t)?(k(n),n.o[t]=R(n.A.h,i,n)):i},has:function(n,t){return t in p(n)},ownKeys:function(n){return Reflect.ownKeys(p(n))},set:function(n,t,r){var e=I(p(n),t);if(null==e?void 0:e.set)return e.set.call(n.k,r),!0;if(n.D[t]=!0,!n.P){if(c(r,z(p(n),t))&&(void 0!==r||u(n.t,t)))return!0;k(n),E(n)}return n.o[t]=r,!0},deleteProperty:function(n,t){return void 0!==z(n.t,t)||t in n.t?(n.D[t]=!1,k(n),E(n)):delete n.D[t],n.o&&delete n.o[t],!0},getOwnPropertyDescriptor:function(n,t){var r=p(n),e=Reflect.getOwnPropertyDescriptor(r,t);return e?{writable:!0,configurable:1!==n.i||\"length\"!==t,enumerable:e.enumerable,value:r[t]}:e},defineProperty:function(){n(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){n(12)}},en={};i(rn,(function(n,t){en[n]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),en.deleteProperty=function(t,r){return\"production\"!==process.env.NODE_ENV&&isNaN(parseInt(r))&&n(13),rn.deleteProperty.call(this,t[0],r)},en.set=function(t,r,e){return\"production\"!==process.env.NODE_ENV&&\"length\"!==r&&isNaN(parseInt(r))&&n(14),rn.set.call(this,t[0],r,e,t[0])};var on=function(){function e(n){this.O=B,this.N=\"production\"!==process.env.NODE_ENV,\"boolean\"==typeof(null==n?void 0:n.useProxies)&&this.setUseProxies(n.useProxies),\"boolean\"==typeof(null==n?void 0:n.autoFreeze)&&this.setAutoFreeze(n.autoFreeze),this.produce=this.produce.bind(this),this.produceWithPatches=this.produceWithPatches.bind(this)}var i=e.prototype;return i.produce=function(t,e,i){if(\"function\"==typeof t&&\"function\"!=typeof e){var o=e;e=t;var u=this;return function(n){var t=this;void 0===n&&(n=o);for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return u.produce(n,(function(n){var r;return(r=e).call.apply(r,[t,n].concat(i))}))}}var a;if(\"function\"!=typeof e&&n(6),void 0!==i&&\"function\"!=typeof i&&n(7),r(t)){var f=w(this),c=R(this,t,void 0),s=!0;try{a=e(c),s=!1}finally{s?g(f):O(f)}return\"undefined\"!=typeof Promise&&a instanceof Promise?a.then((function(n){return j(f,i),P(n,f)}),(function(n){throw g(f),n})):(j(f,i),P(a,f))}if(!t||\"object\"!=typeof t){if((a=e(t))===H)return;return void 0===a&&(a=t),this.N&&d(a,!0),a}n(21,t)},i.produceWithPatches=function(n,t){var r,e,i=this;return\"function\"==typeof n?function(t){for(var r=arguments.length,e=Array(r>1?r-1:0),o=1;o<r;o++)e[o-1]=arguments[o];return i.produceWithPatches(t,(function(t){return n.apply(void 0,[t].concat(e))}))}:[this.produce(n,t,(function(n,t){r=n,e=t})),r,e]},i.createDraft=function(e){r(e)||n(8),t(e)&&(e=D(e));var i=w(this),o=R(this,e,void 0);return o[Q].C=!0,O(i),o},i.finishDraft=function(t,r){var e=t&&t[Q];\"production\"!==process.env.NODE_ENV&&(e&&e.C||n(9),e.I&&n(10));var i=e.A;return j(i,r),P(void 0,i)},i.setAutoFreeze=function(n){this.N=n},i.setUseProxies=function(t){t&&!B&&n(20),this.O=t},i.applyPatches=function(n,r){var e;for(e=r.length-1;e>=0;e--){var i=r[e];if(0===i.path.length&&\"replace\"===i.op){n=i.value;break}}var o=b(\"Patches\").$;return t(n)?o(n,r):this.produce(n,(function(n){return o(n,r.slice(e+1))}))},e}(),un=new on,an=un.produce,fn=un.produceWithPatches.bind(un),cn=un.setAutoFreeze.bind(un),sn=un.setUseProxies.bind(un),vn=un.applyPatches.bind(un),pn=un.createDraft.bind(un),ln=un.finishDraft.bind(un);export default an;export{on as Immer,vn as applyPatches,K as castDraft,$ as castImmutable,pn as createDraft,D as current,J as enableAllPlugins,T as enableES5,C as enableMapSet,F as enablePatches,ln as finishDraft,L as immerable,t as isDraft,r as isDraftable,H as nothing,e as original,an as produce,fn as produceWithPatches,cn as setAutoFreeze,sn as setUseProxies};\n//# sourceMappingURL=immer.esm.js.map\n","import { determineComputationOrder } from \"./computation-order\"\nimport { findRecipe, Recipe } from \"../recipes\"\nimport { isOre, Item, Ore } from \"../items\"\nimport { ContainerNode, FactoryGraph, MachineNode } from \"./graph\"\nimport { simulateAnnealing } from \"./simulated-annealing\"\nimport { Draft, produce } from \"immer\"\n\nexport function buildFactory(products: Map<Exclude<Item, Ore>, number>): FactoryGraph {\n    const graph = initGraph(products)\n\n    const computationOrder = determineComputationOrder(new Set(products.keys()))\n    console.log(\"Computation plan\", computationOrder)\n\n    for (const item of computationOrder) {\n        console.log(\"Computing\", item)\n        if (isOre(item)) {\n            addInputContainers(graph, item)\n        } else {\n            addProducers(graph, item)\n        }\n    }\n\n    return graph\n}\n\nfunction initGraph(products: Map<Exclude<Item, Ore>, number>): FactoryGraph {\n    const graph = new FactoryGraph()\n\n    for (const [item, machineCount] of products) {\n        for (let i = 0; i < Math.ceil(machineCount); i++) {\n            const recipe = findRecipe(item)\n\n            const machine = new MachineNode(recipe, 1)\n            graph.add(machine)\n\n            const container = new ContainerNode()\n            graph.add(container)\n            machine.outputInto(container)\n        }\n    }\n\n    return graph\n}\n\nfunction addInputContainers(graph: FactoryGraph, item: Ore): void {\n    for (const consumer of graph.getConsumers(item)) {\n        const container = new ContainerNode()\n        graph.add(container)\n        consumer.takeFrom(container, item)\n    }\n}\n\nfunction addProducers(graph: FactoryGraph, item: Exclude<Item, Ore>): void {\n    const recipe = findRecipe(item)\n    const result = simulateAnnealing(\n        makeInitialStates(graph, item),\n        mutateLinks(recipe),\n        computeEnergy(recipe),\n        15,\n        0.001,\n        (temp) => temp - 0.001,\n    )\n\n    for (const state of result) {\n        if (state.futureConsumers.size === 0) {\n            continue\n        }\n\n        graph.add(state.container)\n        for (const consumer of state.futureConsumers) {\n            consumer.takeFrom(state.container, item)\n        }\n\n        const ingress = state.container.getIngress(item)\n        const egress = state.container.getEgress(item)\n        const netIngress = ingress - egress\n\n        const utilisation = Math.max(\n            0,\n            -netIngress / (recipe.product.quantity / recipe.processingTime),\n        )\n\n        const neededMachines = Math.ceil(utilisation)\n\n        for (let i = 0; i < neededMachines; i++) {\n            const machine = new MachineNode(recipe, utilisation / neededMachines)\n            graph.add(machine)\n            machine.outputInto(state.container)\n        }\n    }\n}\n\ninterface OptimizerState {\n    containerExistsAlready: boolean\n    container: ContainerNode\n    futureConsumers: Set<MachineNode>\n}\n\nfunction makeInitialStates(graph: FactoryGraph, item: Exclude<Item, Ore>): OptimizerState[] {\n    const consumers = graph.getConsumers(item)\n    const containers = graph.getContainers(item)\n\n    const oldStates: OptimizerState[] = Array.from(containers).map((container) => ({\n        containerExistsAlready: true,\n        container,\n        futureConsumers: new Set(),\n    }))\n\n    const newStates: OptimizerState[] = Array.from(consumers).map((consumer) => ({\n        containerExistsAlready: false,\n        container: new ContainerNode(),\n        futureConsumers: new Set([consumer]),\n    }))\n\n    return [...oldStates, ...newStates]\n}\n\nfunction computeEnergy(recipe: Recipe) {\n    const item = recipe.product.item\n    const machineThroughput = recipe.product.quantity / recipe.processingTime\n\n    return (states: OptimizerState[]): number => {\n        let energy = 0\n        for (const state of states) {\n            if (state.futureConsumers.size > 0 && !state.containerExistsAlready) {\n                energy++ // cost for additional container\n            }\n\n            const currentIngress = state.container.getIngress(item)\n            const currentEgress = state.container.getEgress(item)\n            const futureEgress = Array.from(state.futureConsumers)\n                .map((node) => node.getIntake(item))\n                .reduce((a, b) => a + b, 0)\n\n            const netIngress = currentIngress - currentEgress - futureEgress\n            const neededMachines = -netIngress / machineThroughput\n\n            if (neededMachines > 0) {\n                energy += Math.ceil(neededMachines) // cost for additional machines\n            } else {\n                energy += -neededMachines // cost for wasted machines\n            }\n        }\n        return energy\n    }\n}\n\nfunction mutateLinks(recipe: Recipe) {\n    return produce((states: Draft<OptimizerState[]>) => {\n        const consumer = removeRandomConsumer(states)\n        if (consumer) {\n            addToRandomContainer(states, consumer, recipe)\n        }\n    })\n}\n\nfunction removeRandomConsumer(states: OptimizerState[]): MachineNode | undefined {\n    const possibleStates = states.filter(\n        (containerState) => containerState.futureConsumers.size > 0,\n    )\n\n    const state = chooseRandom(possibleStates)\n    if (!state) {\n        return\n    }\n\n    const consumer = chooseRandom(Array.from(state.futureConsumers))!\n    state.futureConsumers.delete(consumer)\n\n    return consumer\n}\n\nfunction addToRandomContainer(states: OptimizerState[], consumer: MachineNode, recipe: Recipe) {\n    const item = recipe.product.item\n    const machineThroughput = recipe.product.quantity / recipe.processingTime\n\n    const possibleStates = states.filter((containerState) => {\n        const outgoingLinkCount =\n            1 + containerState.container.outgoingLinkCount + containerState.futureConsumers.size\n\n        const currentIngress = containerState.container.getIngress(item)\n        const currentEgress = containerState.container.getEgress(item)\n        const futureEgress =\n            consumer.getIntake(item) +\n            Array.from(containerState.futureConsumers)\n                .map((node) => node.getIntake(item))\n                .reduce((a, b) => a + b, 0)\n\n        const netIngress = currentIngress - currentEgress - futureEgress\n        const neededMachines = Math.ceil(Math.max(0, -netIngress / machineThroughput))\n\n        const incomingLinkCount = containerState.container.incomingLinkCount + neededMachines\n\n        return outgoingLinkCount <= 10 && incomingLinkCount <= 10\n    })\n\n    const state = chooseRandom(possibleStates)\n    if (!state) {\n        return\n    }\n\n    state.futureConsumers.add(consumer)\n}\n\nfunction chooseRandom<T>(arr: T[]): T | undefined {\n    if (arr.length === 0) {\n        return undefined\n    }\n    return arr[Math.floor(Math.random() * arr.length)]\n}\n","export function simulateAnnealing<T>(\n    initialState: T,\n    mutateState: (state: T) => T,\n    computeEnergy: (state: T) => number,\n    tempMax: number,\n    tempMin: number,\n    coolTemp: (temp: number) => number,\n): T {\n    let currentTemp = tempMax\n\n    let currentState = initialState\n    let currentEnergy = computeEnergy(currentState)\n\n    let bestState = currentState\n    let bestEnergy = currentEnergy\n\n    for (let temp = tempMax; temp > tempMin; temp = coolTemp(temp)) {\n        let nextState = mutateState(currentState)\n        let nextEnergy = computeEnergy(nextState)\n\n        if (\n            nextEnergy < currentEnergy ||\n            Math.exp((currentEnergy - nextEnergy) / currentTemp) > Math.random()\n        ) {\n            currentState = nextState\n            currentEnergy = nextEnergy\n\n            if (nextEnergy < bestEnergy) {\n                bestState = nextState\n                bestEnergy = nextEnergy\n            }\n        }\n    }\n\n    return bestState\n}","import { isOre, Item } from \"../items\"\nimport { Batch, findRecipe, Recipe } from \"../recipes\"\nimport { ItemRate } from \"./graph\"\n\nexport class ItemsFlow extends Map<Item, ItemRate> {\n    constructor(itemsStream?: ItemsFlow) {\n        super()\n        if (itemsStream) {\n            this.add(itemsStream)\n        }\n    }\n\n    add(itemStream: ItemsFlow): void\n    add(item: Item, throughput: ItemRate): void\n    add(itemOrStream: Item | ItemsFlow, throughput?: ItemRate): void {\n        if (itemOrStream instanceof ItemsFlow) {\n            for (const [item, throughput] of itemOrStream.entries()) {\n                this.add(item, throughput)\n            }\n        } else {\n            if (this.has(itemOrStream)) {\n                this.set(itemOrStream, this.get(itemOrStream)! + throughput!)\n            } else {\n                this.set(itemOrStream, throughput!)\n            }\n        }\n    }\n\n    set(item: Item, throughput: ItemRate): this {\n        if (throughput < 0) {\n            throw new Error(`Throughput may not be less than 0. Was ${throughput}/min.`)\n        } else if (throughput === 0) {\n            this.delete(item)\n        } else {\n            super.set(item, throughput)\n        }\n        return this\n    }\n\n    covers(itemStream: ItemsFlow): boolean\n    covers(item: Item, throughput: ItemRate): boolean\n    covers(itemOrStream: Item | ItemsFlow, throughput?: ItemRate): boolean {\n        if (itemOrStream instanceof ItemsFlow) {\n            return Array.from(itemOrStream.entries()).every(([item, throughput]) =>\n                this.covers(item, throughput),\n            )\n        } else {\n            return this.has(itemOrStream) && this.get(itemOrStream)! >= throughput!\n        }\n    }\n\n    subtract(itemStream: ItemsFlow): ItemsFlow\n    subtract(item: Item, throughput: ItemRate): ItemRate\n    subtract(itemOrStream: Item | ItemsFlow, throughput?: ItemRate): ItemRate | ItemsFlow {\n        if (itemOrStream instanceof ItemsFlow) {\n            const remainder = new ItemsFlow()\n            for (const [item, throughput] of itemOrStream.entries()) {\n                remainder.add(item, this.subtract(item, throughput))\n            }\n            return remainder\n        } else {\n            const value = this.get(itemOrStream) || 0\n            const result = value - throughput!\n            if (result < 0) {\n                this.delete(itemOrStream)\n                return -result\n            } else {\n                this.set(itemOrStream, result)\n                return 0\n            }\n        }\n    }\n}\n\nfunction computeDependentThroughputs(\n    throughputs: ItemsFlow,\n    dependentItemsGetter: (process: Recipe) => Batch[],\n): ItemsFlow {\n    const dependentThroughputs = new ItemsFlow()\n\n    for (const [item, throughput] of throughputs.entries()) {\n        if (!isOre(item)) {\n            const process = findRecipe(item)\n            for (const dependentItem of dependentItemsGetter(process)) {\n                const dependentThroughput =\n                    (dependentItem.quantity / process.product.quantity) * throughput\n\n                dependentThroughputs.add(dependentItem.item, dependentThroughput)\n            }\n        }\n    }\n\n    return dependentThroughputs\n}\n\nfunction computeIngress(egress: ItemsFlow): ItemsFlow {\n    return computeDependentThroughputs(egress, (process) => process.ingredients)\n}\n\nfunction computeByproductEgress(egress: ItemsFlow): ItemsFlow {\n    return computeDependentThroughputs(egress, (process) => process.byproducts)\n}\n\nfunction computeAdditionalThroughputs(throughputs: ItemsFlow, minimumEgress: ItemsFlow): ItemsFlow {\n    throughputs = new ItemsFlow(throughputs) // avoid mutating throughputs\n    const additionalThroughputs = new ItemsFlow()\n    let ingress = minimumEgress\n\n    while (ingress.size > 0) {\n        const remainingIngress = throughputs.subtract(ingress)\n        additionalThroughputs.add(remainingIngress)\n        ingress = computeIngress(remainingIngress)\n    }\n\n    return additionalThroughputs\n}\n\nexport function computeThroughputs(minimumEgress: ItemsFlow): ItemsFlow {\n    let throughputs = new ItemsFlow()\n    let byproductEgress = new ItemsFlow()\n    for (let i = 0; i < 1000; i++) {\n        throughputs = computeAdditionalThroughputs(byproductEgress, minimumEgress)\n        const updatedByproductsEgress = computeByproductEgress(throughputs)\n\n        if (\n            byproductEgress.covers(updatedByproductsEgress) &&\n            updatedByproductsEgress.covers(byproductEgress)\n        ) {\n            break\n        }\n\n        byproductEgress = updatedByproductsEgress\n    }\n\n    return throughputs\n}\n\nexport function computeIdealMachineCount(throughputs: ItemsFlow): Map<Item, [string, number]> {\n    const machines = new Map<Item, [string, number]>()\n\n    for (const [item, throughput] of throughputs.entries()) {\n        if (!isOre(item)) {\n            const process = findRecipe(item)\n            machines.set(item, [\n                process.producedWith.name,\n                throughput / (process.product.quantity / process.processingTime),\n            ])\n        }\n    }\n\n    return machines\n}\n","import { items } from \"./items\"\nimport { buildFactory } from \"./compute/factory\"\nimport { enableMapSet } from \"immer\"\nimport {\n    computeIdealMachineCount,\n    computeThroughputs,\n    ItemsFlow,\n} from \"./compute/ideal-machine-count\"\n\nenableMapSet()\n\nObject.assign(window, {\n    items,\n    buildFactory,\n    computeIdealMachineCount,\n    computeThroughputs,\n    ItemsFlow,\n})\n\nconsole.log(\n    `\n%cGenerate a factory (slow): \n\n// produce each item with two assemblers\nconst assemblyMachines = new Map([\n    [items.adjuster_l, 2],\n    [items.vertical_booster_l, 2],\n    [items.retro_rocket_brake_l, 2],\n])\nbuildFactory(assemblyMachines)\n`,\n    \"color: #000099\",\n)\n\nconsole.log(\n    `\n%cCompute the minimum number of machines required (fast):\n\nconst requiredOutput = new ItemsFlow()\n// produce at least 2 of each in 32 minutes\nrequiredOutput.add(items.adjuster_l, 2 / 32)\nrequiredOutput.add(items.vertical_booster_l, 2 / 32)\nrequiredOutput.add(items.retro_rocket_brake_l, 2 / 32)\ncomputeIdealMachineCount(computeThroughputs(requiredOutput))\n`,\n    \"color: #880088\",\n)\n"],"sourceRoot":""}